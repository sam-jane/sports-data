---
title: "Women's Soccer Data"
---

We'll use this notebook to explore some NCAA women's soccer data and [our questions](https://docs.google.com/spreadsheets/d/1G1AjH2iS6kj3kKHCRi0XVy5Lcm-rahJkeTAToVh9J1g/edit?gid=0#gid=0). First, let's load the tidyverse library:

```{r}
library(tidyverse)
```


We'll want to start with 2025 match data, which is located in [this GitHub repository](https://github.com/dwillis/NCAAWomensSoccerData). We can load the match data directly from GitHub using `read_csv`:


```{r}
matches_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv")
```
```{r}
matches_2024 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv")
```
```{r}
matches_2022 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2022.csv")
```
Let's take a look at this data to see what it contains, using `head` and `glimpse`:

```{r}
head(matches_2025)
glimpse(matches_2025)
```

Now, onto the questions using aggregates, which means `group_by` and `summarize`:

1. How many shots in total has Maryland attempted and how many have been on goal? Calculate a percentage of shots on goal. 
#Maryland has a 54% shot on goal rate

```{r}
terrapins_goals <- matches_2025 |>
  group_by(team) |>
  summarise(
    total_shots = sum(sh_att),
    shots_on_goal = sum(so_g),
    percentage_on_goal = (shots_on_goal / total_shots) * 100
  )
```

2. What about the same shot stats from last season's first four games? You'll need to load the matches from 2024 - just change the season in the URL - and filter by date to find the first four games.

```{r}
terps_2024 <- matches_2024 |>
  filter(team == "Maryland Terrapins, Terps")
```

```{r}
terps_shotsongoal_2024 <- matches_2024 |>
  filter(team == "Maryland Terrapins, Terps",
         date >= "2024-08-15",
         date <= "2024-08-25") |>
  summarise(
    shots_tot = sum(sh_att),
    shots_on_goal = sum(so_g),
    goal_percentage = (shots_on_goal / shots_tot) * 100
  )
```



###3. Maryland started 2022 with 4 draws. Have any other teams had as many this season?

```{r}
draws_2025 <- matches_2025 |> 
  filter(date >= as.Date("2025-01-01")) |> 
  group_by(team) |> 
  summarise(draws = sum(outcome == "Draw", na.rm = TRUE), .groups = "drop")
```

```{r}
draws_2025_desc <- draws_2025 |> arrange(desc(draws))
View(draws_2025_desc)
```

4. How many total corner kicks has Maryland had so far this season and how many have its opponents have? Calculate the difference between the two totals for every team using group_by, summarize and mutate, then filter to find Maryland's totals.

```{r}
corner_kicks_ <- matches_2025 |> 
  group_by(team) |> 
  summarise(
    total_team_corners = sum(corners, na.rm = TRUE),
    total_opponent_corners = sum(defensive_corners, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(
    corner_ratio = total_team_corners / total_opponent_corners
  ) |> 
  arrange(desc(corner_ratio)) 
View(corner_kicks_)
```

###5. What's the most interesting thing you've seen from these questions?
# I think the most interesting thing I found is that Maryland has one of the worst corner ratios in the country. That is clearly a sign of some of the top teams, and I think that using that data, especially from the previous years is very interesting.


```{r}
library(tidyverse)
```

```{r}
correlations <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv")
```
```{r}
newcorrelations <- correlations |> 
  mutate(
    differential = goals - defensive_goals
    
    )

newcorrelations <- newcorrelations |>
mutate(homeaway = case_when(
  grepl("Away", home_away) ~ 0,
  grepl("Home", home_away) ~ 1
  ),
  corners = as.numeric(defensive_corners),
    goals = as.numeric(goals)
)

terps25 <- newcorrelations |>
  filter(team == "Maryland Terrapins, Terps")

finalcorrelations <- newcorrelations |> 
  mutate(
    corner_kicks = as.numeric(defensive_corners),
    goals = as.numeric(goals)
  )

finalcorrelations |> 
  summarise(correlation = cor(corner_kicks, goals, method = "pearson"))
```

```{r}
newcorrelations |> summarise(correlation = cor(differential, fouls, method="pearson"))
```
```{r}
newcorrelations |> 
  summarise(correlation = cor(differential, so_g, method="pearson"))
```

```{r}
net <- lm(differential ~ so_g, data = newcorrelations)
summary(net)
```
### There's not much of a linkage between allowing corner shots and goals allowed. While the perception of the scoring opportunities and corners are correlated between each other, there is a statistically insignificant tie between the plays. 



##Residuals
```{r}
matches_2025 <- matches_2025 |>
  mutate(differential = team_score - opponent_score)
```

```{r}
fit <- lm(differential ~ goals + defensive_fouls + defensive_yellow_cards,
           data = matches_2025)
summary(fit)
```
##2
```{r}
matches_2025 <- matches_2025 |>
  mutate(
    predicted = predict(fit, newdata = matches_2025),
    residuals = residuals(fit)
  )
```

##3
```{r}
matches_2025 |>
  arrange(desc(residuals)) |>
  slice_head(n = 10) |>
  select(team, opponent, differential, predicted, residuals)
```

```{r}
matches_2025 |>
  arrange(residuals) |>
  slice_head(n = 10) |>
  select(team, opponent, differential, predicted, residuals)
```
###I noticed a lot of these outlier games in the negative came from low-level teams that are not Division one or power five and lost to top teams. The model clearly predicted not wide enough of gaps for some of these games, probably assuming that soccer wasn't going to have a eight or nine goal margin lol. On the other hand, the positive models where teams overperformed was between lower level teams who tied with higher level teams
```{r}
matches_2025 |>
  filter(team == "Maryland Terrapins, Terps") |>
  arrange(residuals) |>
  select(date, opponent, differential, predicted, residuals)
```
###Maryland has tended to overperform this season, outprojecting their model eight times this season compared to the four times they underperformed. Their biggest overprojection came against UMBC, when they were projected to lose by just under a goal and won by one. Their worst projection came agianst Penn State when they were blown out. It would be very interesting to look at 2024 and see how many times they underperformed the model in such a bad season. That could do some justice to the claim that while the record is not substantially improving, the program is getting better. That's a story I would want to pursue the most moving forward.
